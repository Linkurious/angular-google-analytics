/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.0.15 - 2015-07-09
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-google-analytics",[]).service("Analytics",["$document","$location","$log","$rootScope","$window",function(a,b,c,d,e){function f(a){!s&&e._gaq&&"function"==typeof a&&a()}function g(a){s&&e.ga&&"function"==typeof a&&a()}function h(a,b){return!angular.isUndefined(b)&&"name"in b&&b.name?b.name+"."+a:a}function i(a,b){return a in b&&b[a]}var j,k,l,m,n,o,p=!1,q=!0,r="",s=!1,t="$routeChangeSuccess",u="auto",v=!1,w=!1,x=!1,y=!1,z=!1,A={allowLinker:!0},B=!1,C=!1;this._logs=[],this.setAccount=function(a){return j=a,!0},this.trackPages=function(a){return q=a,!0},this.trackPrefix=function(a){return r=a,!0},this.setDomainName=function(a){return l=a,!0},this.useDisplayFeatures=function(a){return k=!!a,!0},this.useAnalytics=function(a){return s=!!a,!0},this.useEnhancedLinkAttribution=function(a){return x=!!a,!0},this.useCrossDomainLinker=function(a){return z=!!a,!0},this.setCrossLinkDomains=function(a){return o=a,!0},this.setPageEvent=function(a){return t=a,!0},this.setCookieConfig=function(a){return u=a,!0},this.useECommerce=function(a,b){return v=!!a,w=!!b,!0},this.setRemoveRegExp=function(a){return a instanceof RegExp?(m=a,!0):!1},this.setExperimentId=function(a){return n=a,!0},this.ignoreFirstPageLoad=function(a){return y=!!a,!0},this.trackUrlParams=function(a){return B=!!a,!0},this.delayScriptTag=function(a){return C=!!a,!0};var D=this,E=function(){var a=B?b.url():b.path();return m?a.replace(m,""):a},F=function(){var a={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},c={};return angular.forEach(b.search(),function(b,d){var e=a[d];angular.isDefined(e)&&(c[e]=b)}),c};return this._log=function(){arguments.length>0&&(arguments.length>1&&"warn"===arguments[0]&&c.warn(Array.prototype.slice.call(arguments,1)),this._logs.push(arguments))},this._createScriptTag=function(){if(!j)return void D._log("warn","No account id set to create script tag");if(p)return void D._log("warn","Script tag already created");e._gaq=[],e._gaq.push(["_setAccount",j]),l&&e._gaq.push(["_setDomainName",l]),x&&e._gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]),q&&!y&&(m?e._gaq.push(["_trackPageview",E()]):e._gaq.push(["_trackPageview"]));var b;return b=k?("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",function(){var c=a[0],d=c.createElement("script");d.type="text/javascript",d.async=!0,d.src=b;var e=c.getElementsByTagName("script")[0];e.parentNode.insertBefore(d,e)}(b),q&&d.$on(t,function(){D._trackPage()}),p=!0},this._createAnalyticsScriptTag=function(){if(!j)return void D._log("warn","No account id set to create analytics script tag");if(p)return void D._log("warn","Analytics script tag already created");if(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),angular.isArray(j)?j.forEach(function(a){var b,c="cookieConfig"in a?a.cookieConfig:u;i("crossDomainLinker",a)&&(a.allowLinker=a.crossDomainLinker),angular.forEach(["name","allowLinker"],function(c){c in a&&(angular.isUndefined(b)&&(b={}),b[c]=a[c])}),angular.isUndefined(b)?e.ga("create",a.tracker,c):e.ga("create",a.tracker,c,b),b&&"allowLinker"in b&&b.allowLinker&&(e.ga(h("require",a),"linker"),i("crossLinkDomains",a)&&e.ga(h("linker:autoLink",a),a.crossLinkDomains))}):z?(e.ga("create",j,u,A),e.ga("require","linker"),o&&e.ga("linker:autoLink",o)):e.ga("create",j,u),k&&e.ga("require","displayfeatures"),q&&!y&&e.ga("send","pageview",E()),e.ga&&(v&&(w?e.ga("require","ec","ec.js"):e.ga("require","ecommerce","ecommerce.js")),x&&e.ga("require","linkid","linkid.js"),n)){var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.src="//www.google-analytics.com/cx/api.js?experiment="+n,b.parentNode.insertBefore(a,b)}return q&&d.$on(t,function(){D._trackPage()}),p=!0},this._ecommerceEnabled=function(){return v?w?(this._log("warn","Enhanced ecommerce plugin is enabled. Only one plugin(ecommerce/ec) can be used at a time. Use AnalyticsProvider.setECommerce(true, false);"),!1):!0:(this._log("warn","ecommerce not set. Use AnalyticsProvider.setECommerce(true, false);"),!1)},this._enhancedEcommerceEnabled=function(){return v?w?!0:(this._log("warn","Enhanced ecommerce plugin is disabled. Use AnalyticsProvider.setECommerce(true, true);"),!1):(this._log("warn","ecommerce not set. Use AnalyticsProvider.setECommerce(true, true);"),!1)},this._trackPage=function(b,c,d){var i=this,k=arguments;b=b?b:E(),c=c?c:a[0].title,f(function(){e._gaq.push(["_set","title",c]),e._gaq.push(["_trackPageview",r+b]),i._log("_trackPageview",b,c,k)}),g(function(){var a={page:r+b,title:c};angular.extend(a,F()),angular.isObject(d)&&angular.extend(a,d),angular.isArray(j)?j.forEach(function(b){e.ga(h("send",b),"pageview",a)}):e.ga("send","pageview",a),i._log("pageview",b,c,k)})},this._trackEvent=function(a,b,c,d,k,l){var m=this,n=arguments;f(function(){e._gaq.push(["_trackEvent",a,b,c,d,!!k]),m._log("trackEvent",n)}),g(function(){var f={};angular.isDefined(k)&&(f.nonInteraction=!!k),angular.isObject(l)&&angular.extend(f,l),angular.isArray(j)?j.forEach(function(g){i("trackEvent",g)&&e.ga(h("send",g),"event",a,b,c,d,f)}):e.ga("send","event",a,b,c,d,f),m._log("event",n)})},this._addTrans=function(a,b,c,d,h,i,j,k,l){var m=this,n=arguments;f(function(){e._gaq.push(["_addTrans",a,b,c,d,h,i,j,k]),m._log("_addTrans",n)}),g(function(){m._ecommerceEnabled()&&(e.ga("ecommerce:addTransaction",{id:a,affiliation:b,revenue:c,tax:d,shipping:h,currency:l||"USD"}),m._log("ecommerce:addTransaction",n))})},this._addItem=function(a,b,c,d,h,i){var j=this,k=arguments;f(function(){e._gaq.push(["_addItem",a,b,c,d,h,i]),j._log("_addItem",k)}),g(function(){j._ecommerceEnabled()&&(e.ga("ecommerce:addItem",{id:a,name:c,sku:b,category:d,price:h,quantity:i}),j._log("ecommerce:addItem",k))})},this._trackTrans=function(){var a=this,b=arguments;f(function(){e._gaq.push(["_trackTrans"]),a._log("_trackTrans",b)}),g(function(){a._ecommerceEnabled()&&(e.ga("ecommerce:send"),a._log("ecommerce:send",b))})},this._clearTrans=function(){var a=this,b=arguments;g(function(){a._ecommerceEnabled()&&(e.ga("ecommerce:clear"),a._log("ecommerce:clear",b))})},this._addProduct=function(a,b,c,d,h,i,j,k,l){var m=this,n=arguments;f(function(){e._gaq.push(["_addProduct",a,b,c,d,h,i,j,k,l]),m._log("_addProduct",n)}),g(function(){m._enhancedEcommerceEnabled()&&(e.ga("ec:addProduct",{id:a,name:b,category:c,brand:d,variant:h,price:i,quantity:j,coupon:k,position:l}),m._log("ec:addProduct",n))})},this._addImpression=function(a,b,c,d,h,i,j,k){var l=this,m=arguments;f(function(){e._gaq.push(["_addImpression",a,b,c,d,h,i,j,k]),l._log("_addImpression",m)}),g(function(){l._enhancedEcommerceEnabled()&&e.ga("ec:addImpression",{id:a,name:b,category:h,brand:d,variant:i,list:c,position:j,price:k}),l._log("ec:addImpression",m)})},this._addPromo=function(a,b,c,d){var h=this,i=arguments;f(function(){e._gaq.push(["_addPromo",a,b,c,d]),h._log("_addPromo",arguments)}),g(function(){h._enhancedEcommerceEnabled()&&(e.ga("ec:addPromo",{id:a,name:b,creative:c,position:d}),h._log("ec:addPromo",i))})},this._getActionFieldObject=function(a,b,c,d,e,f,g,h,i){var j={};return a&&(j.id=a),b&&(j.affiliation=b),c&&(j.revenue=c),d&&(j.tax=d),e&&(j.shipping=e),f&&(j.coupon=f),g&&(j.list=g),h&&(j.step=h),i&&(j.option=i),j},this._setAction=function(a,b){var c=this,d=arguments;f(function(){e._gaq.push(["_setAction",a,b]),c._log("__setAction",d)}),g(function(){c._enhancedEcommerceEnabled()&&(e.ga("ec:setAction",a,b),c._log("ec:setAction",d))})},this._trackTransaction=function(a,b,c,d,e,f,g,h,i){this._setAction("purchase",this._getActionFieldObject(a,b,c,d,e,f,g,h,i))},this._trackRefund=function(a){this._setAction("refund",this._getActionFieldObject(a))},this._trackCheckOut=function(a,b){this._setAction("checkout",this._getActionFieldObject(null,null,null,null,null,null,null,a,b))},this._trackCart=function(a){-1!==["add","remove"].indexOf(a)&&(this._setAction(a),this._send("event","UX","click",a+" to cart"))},this._promoClick=function(a){this._setAction("promo_click"),this._send("event","Internal Promotions","click",a)},this._productClick=function(a){this._setAction("click",this._getActionFieldObject(null,null,null,null,null,null,a,null,null)),this._send("event","UX","click",a)},this._send=function(){var a=this,b=Array.prototype.slice.call(arguments);b.unshift("send"),g(function(){e.ga.apply(this,b),a._log(b)})},this._pageView=function(){this._send("pageview")},this._set=function(a,b){var c=this;g(function(){e.ga("set",a,b),c._log("set",a,b)})},this._trackTimings=function(a,b,c,d){this._send("timing",a,b,c,d)},{setAccount:this.setAccount,trackPages:this.trackPages,trackPrefix:this.trackPrefix,setDomainName:this.setDomainName,useDisplayFeatures:this.useDisplayFeatures,useAnalytics:this.useAnalytics,useEnhancedLinkAttribution:this.useEnhancedLinkAttribution,useCrossDomainLinker:this.useCrossDomainLinker,setCrossLinkDomains:this.setCrossLinkDomains,setPageEvent:this.setPageEvent,useECommerce:this.useECommerce,setRemoveRegExp:this.setRemoveRegExp,setExperimentId:this.setExperimentId,trackUrlParams:this.trackUrlParams,_logs:D._logs,displayFeatures:k,ecommerce:v,enhancedEcommerce:w,enhancedLinkAttribution:x,getUrl:E,experimentId:n,ignoreFirstPageLoad:y,delayScriptTag:C,setCookieConfig:D._setCookieConfig,getCookieConfig:function(){return u},createAnalyticsScriptTag:function(a){return a&&(u=a),D._createAnalyticsScriptTag()},createScriptTag:function(a){return a&&(u=a),D._createScriptTag()},ecommerceEnabled:function(){return D._ecommerceEnabled()},enhancedEcommerceEnabled:function(){return D._enhancedEcommerceEnabled()},trackPage:function(a,b,c){D._trackPage(a,b,c)},trackEvent:function(a,b,c,d,e,f){D._trackEvent(a,b,c,d,e,f)},addTrans:function(a,b,c,d,e,f,g,h,i){D._addTrans(a,b,c,d,e,f,g,h,i)},addItem:function(a,b,c,d,e,f){D._addItem(a,b,c,d,e,f)},trackTrans:function(){D._trackTrans()},clearTrans:function(){D._clearTrans()},addProduct:function(a,b,c,d,e,f,g,h,i){D._addProduct(a,b,c,d,e,f,g,h,i)},addPromo:function(a,b,c,d){D._addPromo(a,b,c,d)},addImpression:function(a,b,c,d,e,f,g,h){D._addImpression(a,b,c,d,e,f,g,h)},productClick:function(a){D._productClick(a)},promoClick:function(a){D._promoClick(a)},trackDetail:function(){D._setAction("detail"),D._pageView()},trackCart:function(a){D._trackCart(a)},trackCheckout:function(a,b){D._trackCheckOut(a,b)},trackTimings:function(a,b,c,d){D._trackTimings(a,b,c,d)},trackTransaction:function(a,b,c,d,e,f,g,h,i){D._trackTransaction(a,b,c,d,e,f,g,h,i)},setAction:function(a,b){D._setAction(a,b)},send:function(a){D._send(a)},pageView:function(){D._pageView()},set:function(a,b){D._set(a,b)}}}]).directive("gaTrackEvent",["Analytics","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.gaTrackEvent);d.bind("click",function(){f.length>1&&a.trackEvent.apply(a,f(c))})}}}]);